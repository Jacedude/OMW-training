<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMW 2026 Training Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .check-box { transition: all 0.2s; }
        .check-box.checked { background-color: #3b82f6; border-color: #3b82f6; }
    </style>
</head>
<body class="h-screen flex flex-col lg:flex-row overflow-hidden">

    <!-- NAVIGATION (Mobile Bottom / Desktop Side) -->
    <nav class="fixed bottom-0 w-full lg:relative lg:w-64 bg-slate-900 border-t lg:border-t-0 lg:border-r border-slate-800 z-50 flex-shrink-0">
        <div class="flex lg:flex-col justify-around lg:justify-start h-full p-2 lg:p-6 gap-2">
            <div class="hidden lg:block mb-8">
                <h1 class="text-2xl font-black italic text-white tracking-tighter">OMW <span class="text-blue-500">2026</span></h1>
                <div class="text-xs text-slate-500 font-mono mt-1">ATHLETE PROTOCOL V1.2</div>
            </div>
            
            <button onclick="switchTab('plan')" id="btn-plan" class="nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-blue-400 bg-slate-800 transition-all">
                <i data-lucide="calendar" class="w-5 h-5 mb-1 lg:mb-0 lg:mr-3"></i>
                <span class="text-[10px] lg:text-sm font-bold">PLAN</span>
            </button>

            <button onclick="switchTab('fuel')" id="btn-fuel" class="nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-slate-500 hover:bg-slate-800 transition-all">
                <i data-lucide="flame" class="w-5 h-5 mb-1 lg:mb-0 lg:mr-3"></i>
                <span class="text-[10px] lg:text-sm font-bold">FUEL</span>
            </button>

            <button onclick="switchTab('recovery')" id="btn-recovery" class="nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-slate-500 hover:bg-slate-800 transition-all">
                <i data-lucide="activity" class="w-5 h-5 mb-1 lg:mb-0 lg:mr-3"></i>
                <span class="text-[10px] lg:text-sm font-bold">RECOVERY</span>
            </button>

            <button onclick="switchTab('gear')" id="btn-gear" class="nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-slate-500 hover:bg-slate-800 transition-all">
                <i data-lucide="settings" class="w-5 h-5 mb-1 lg:mb-0 lg:mr-3"></i>
                <span class="text-[10px] lg:text-sm font-bold">GEAR</span>
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main id="main-content" class="flex-1 overflow-y-auto p-4 pb-24 lg:p-8 no-scrollbar scroll-smooth">
        <!-- Content injected via JS -->
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA ---
        const RECOVERY_ROUTINES = {
            'A': { title: "Routine A: The Flush", sub: "Parasympathetic Reset", time: "10m", steps: ["Legs Up Wall (3m)", "Box Breathing (2m)", "Light Calf Roll (2m)", "Child's Pose (2m)", "Hydrate (16oz)"] },
            'B': { title: "Routine B: The Unlock", sub: "Hip & Spine Mobility", time: "10m", steps: ["T-Spine Ext (2m)", "Couch Stretch (2m/side)", "90/90 Hip Switch (2m)", "Cat/Cow (2m)", "Deep Squat Hold (2m)"] },
            'C': { title: "Routine C: The Release", sub: "Deep Tissue", time: "10m", steps: ["Gun: Glute Med (2m)", "Gun: Quads (2m)", "Roll IT Band (2m)", "Pigeon Pose (2m)", "Hamstring Floss (2m)"] },
            'D': { title: "Routine D: The Foundation", sub: "Core Strength", time: "20m", steps: ["Pallof Press (3x10)", "DB Goblet Squat (3x12)", "Dead Bug (3x10)", "Band Clamshells (3x15)", "Plank Saw (3x45s)"] },
            'E': { title: "Routine E: The Stabilizer", sub: "Ankle/Shoulder", time: "15m", steps: ["Mobo Rock (3x1m)", "DB Scaption (3x10)", "Single Leg RDL (3x10)", "Band Pull-Apart (3x15)", "Mobo Lateral (3x1m)"] }
        };

        const FLUX_DATA = {
            'High': { color: 'green', desc: "PERFORMANCE. High carbs. No deficit.", b: "Oats + Banana + Syrup", l: "Rice Bowl + Chicken", d: "Pasta + Lean Beef", pre: "45g Carbs (Gel)", intra: "100g Carb/hr" },
            'Moderate': { color: 'yellow', desc: "MAINTENANCE. Fuel the work.", b: "Yogurt + Berries", l: "Quinoa + Chicken", d: "Steak + Potato", pre: "Banana", intra: "50g Carb/hr" },
            'Low': { color: 'red', desc: "FAT LOSS. High protein, low starch.", b: "Veggie Omelet", l: "Salad + Tuna", d: "White Fish + Asparagus", pre: "Black Coffee", intra: "Water Only" }
        };

        const GEAR_MATRIX = {
            "10-20F": { "Dry": { u: "Mesh + Merino + Perfetto + Vest", l: "Sorpasso + Wind Brief", e: "Lobster Claws / Winter Boot" }, "Wet": { u: "ADD: Hardshell Jacket", l: "ADD: Rain Trousers", e: "Neoprene Gloves / Vapor Socks" } },
            "20-30F": { "Dry": { u: "Merino Base + Perfetto", l: "Sorpasso Tights", e: "Lobster Claws / Wool Sock" }, "Wet": { u: "Perfetto + Rain Shell", l: "Sorpasso (DWR)", e: "Neoprene Gloves / Tape Vents" } },
            "30-40F": { "Dry": { u: "Synth Base + Perfetto", l: "Sorpasso Tights", e: "Windproof Glove / Toe Covers" }, "Wet": { u: "Perfetto + Rain Vest", l: "Sorpasso + Ass Saver", e: "RoS Glove / Neoprene Bootie" } },
            "40-50F": { "Dry": { u: "Summer Base + Perfetto", l: "Sorpasso OR Bibs", e: "Light Full Finger" }, "Wet": { u: "Perfetto (Closed Vents)", l: "Sorpasso (Nano Flex)", e: "Neoprene / Velotoze" } }
        };

        const WEEKS = {
            1: { title: "Phase 1: Build", focus: "Stability", days: [
                { t: "Run", title: "VO2 Intervals", dur: "50m", tss: 70, fl: "Moderate", rec: "B", ex: ["Warmup 10m", "6x800m @ 6:25", "Cooldown 10m"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h30", tss: 90, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Hard Threshold", "RUN: 30m Easy Z2 (8:00+)", "Routine D: Core"] },
                { t: "Double", title: "Double Threshold", dur: "1h45", tss: 140, fl: "High", rec: "C", ex: ["AM: 45m Tempo Run", "PM: 5x3m Bike @ 315W"] },
                { t: "Double", title: "Bike (VO2) + Swim", dur: "1h45", tss: 110, fl: "Moderate", rec: "E", ex: ["BIKE: 60m w/ 6x3m @ 315W", "SWIM: 45m Easy", "Routine E: Stability"] },
                { t: "Swim", title: "Volume Swim", dur: "60m", tss: 45, fl: "Low", rec: "B", ex: ["Steady State", "Focus: Volume"] },
                { t: "Run", title: "Long Trail Run", dur: "70m", tss: 70, fl: "High", rec: "C", ex: ["Trails HR<145", "Focus: Ankle Stability"] },
                { t: "Bike", title: "Gravel Skills", dur: "2.5h", tss: 130, fl: "Moderate", rec: "A", ex: ["Find Mud/Gravel", "190W Avg"] }
            ]},
            2: { title: "Phase 1: Build", focus: "Force", days: [
                { t: "Run", title: "Threshold Run", dur: "55m", tss: 75, fl: "Moderate", rec: "B", ex: ["5x1000m @ 6:40", "Race Pace Lock"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h35", tss: 95, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Threshold", "RUN: 35m Easy Z2", "Routine D: Core"] },
                { t: "Double", title: "Double Threshold", dur: "1h50", tss: 160, fl: "High", rec: "C", ex: ["AM: 25m Run @ 7:00", "PM: 3x10m Torque @ 250W"] },
                { t: "Double", title: "Sprints + Swim", dur: "1h45", tss: 105, fl: "Moderate", rec: "E", ex: ["BIKE: 10x30s Max Sprints", "SWIM: 45m Easy", "Routine E: Stability"] },
                { t: "Double", title: "Bike + Swim", dur: "2h", tss: 75, fl: "Low", rec: "B", ex: ["BIKE: 60m Easy <150W", "SWIM: 60m Moderate", "Goal: Volume"] },
                { t: "Swim", title: "Volume Swim", dur: "60m", tss: 45, fl: "High", rec: "C", ex: ["Steady State", "Volume"] },
                { t: "Run", title: "Long Run Hilly", dur: "75m", tss: 75, fl: "Moderate", rec: "A", ex: ["Hilly Route", "Durability Focus"] }
            ]},
            3: { title: "Phase 1: Specificity", focus: "VO2 Support", days: [
                { t: "Run", title: "Mile Reps", dur: "60m", tss: 80, fl: "Moderate", rec: "B", ex: ["3x1600m @ 6:40", "3:00 jog rest"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h40", tss: 105, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Hard Threshold", "RUN: 40m Easy Z2", "Routine D: Core"] },
                { t: "Double", title: "Double Threshold", dur: "1h45", tss: 165, fl: "High", rec: "C", ex: ["AM: 50m Run w/ 2x15m Tempo", "PM: 2x20m Bike @ 250W"] },
                { t: "Double", title: "Bike + Swim", dur: "1h45", tss: 115, fl: "Moderate", rec: "E", ex: ["BIKE: 6x3m @ 320W", "SWIM: 45m Easy", "Routine E: Stability"] },
                { t: "Bike", title: "Recovery Spin", dur: "45m", tss: 25, fl: "Low", rec: "B", ex: ["Strict <150W", "Parasympathetic"] },
                { t: "Swim", title: "Volume Swim", dur: "60m", tss: 45, fl: "High", rec: "C", ex: ["Steady State", "Volume"] },
                { t: "Run", title: "Long Run", dur: "80m", tss: 80, fl: "Moderate", rec: "A", ex: ["Trails 22", "Base Building"] }
            ]},
            4: { title: "Phase 1: Specificity", focus: "Mental Toughness", days: [
                { t: "Run", title: "Mile Reps", dur: "65m", tss: 85, fl: "Moderate", rec: "B", ex: ["4x1600m @ 6:40", "Mental Toughness"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h40", tss: 105, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Threshold", "RUN: 40m Easy Z2", "Routine D: Core"] },
                { t: "Double", title: "AM Brick", dur: "1h30", tss: 110, fl: "High", rec: "C", ex: ["Bike: 45m w/ Tempo", "Run: 20m Tempo off bike"] },
                { t: "Rest", title: "TRAVEL DAY", dur: "0m", tss: 0, fl: "Moderate", rec: "B", ex: ["Rest", "Compression Socks", "Hydrate"] },
                { t: "Run", title: "Maintenance", dur: "50m", tss: 65, fl: "Low", rec: "B", ex: ["20m @ 6:50", "Hotel Treadmill OK"] },
                { t: "Run", title: "Long Run", dur: "90m", tss: 90, fl: "High", rec: "C", ex: ["Hilly Z2", "Volume Completion"] },
                { t: "Swim", title: "Recovery Swim", dur: "60m", tss: 45, fl: "Moderate", rec: "A", ex: ["Aerobic", "Offload Legs"] }
            ]},
            5: { title: "Phase 1: Travel", focus: "Maintenance", days: [
                { t: "Run", title: "Best 10k", dur: "70m", tss: 95, fl: "Moderate", rec: "B", ex: ["3x2 Miles @ 6:45", "Race Predictor"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h30", tss: 75, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Moderate", "RUN: 30m Easy Z2"] },
                { t: "Run", title: "Tempo Run", dur: "45m", tss: 60, fl: "High", rec: "C", ex: ["45m w/ 20m Tempo", "Lactate Clear"] },
                { t: "Rest", title: "TRAVEL DAY", dur: "0m", tss: 0, fl: "Moderate", rec: "B", ex: ["Rest", "Hydrate"] },
                { t: "Bike", title: "Wake Legs", dur: "60m", tss: 45, fl: "Low", rec: "B", ex: ["60m Z2", "4x1m Spin-ups"] },
                { t: "Swim", title: "Volume Swim", dur: "60m", tss: 45, fl: "High", rec: "C", ex: ["Moderate", "Volume"] },
                { t: "Run", title: "Long Run", dur: "90m", tss: 90, fl: "Moderate", rec: "A", ex: ["Z2 Durability", "Last Long Run"] }
            ]},
            6: { title: "Phase 2: Peak", focus: "Over-Speed", days: [
                { t: "Run", title: "Speed Intervals", dur: "60m", tss: 85, fl: "Moderate", rec: "D", ex: ["5x1200m @ 6:30", "Over-Speed"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h40", tss: 105, fl: "Moderate", rec: "D", ex: ["SWIM: 60m Threshold", "RUN: 40m Easy Z2"] },
                { t: "Double", title: "Double Threshold", dur: "1h45", tss: 165, fl: "High", rec: "C", ex: ["AM: 45m Run w/ 20m 10k Pace", "PM: 4x8m Bike @ 285W"] },
                { t: "Double", title: "Bike + Swim", dur: "1h45", tss: 115, fl: "Moderate", rec: "E", ex: ["BIKE: 8x2m @ 350W", "SWIM: 45m Easy", "Routine E"] },
                { t: "Bike", title: "Recovery Spin", dur: "45m", tss: 25, fl: "Low", rec: "B", ex: ["Strict <150W", "Reset"] },
                { t: "Run", title: "Sim Run", dur: "45m", tss: 65, fl: "High", rec: "C", ex: ["AM: 10k Tempo", "PM: 2h Bike (Fatigued Pwr)"] },
                { t: "Run", title: "Recovery Run", dur: "45m", tss: 45, fl: "Moderate", rec: "A", ex: ["Easy Z2", "Recovery"] }
            ]},
            7: { title: "Phase 2: Peak/Taper", focus: "Sharpness", days: [
                { t: "Run", title: "Taper Intervals", dur: "50m", tss: 65, fl: "Moderate", rec: "B", ex: ["6x800m @ 6:40", "Form Focus"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h20", tss: 70, fl: "Moderate", rec: "D", ex: ["SWIM: 50m Moderate", "RUN: 30m Easy Z2"] },
                { t: "Double", title: "Double Taper", dur: "1h40", tss: 130, fl: "High", rec: "C", ex: ["Run: 40m w/ 2x10m Tempo", "Bike: 1h w/ 2x10m @ 250W"] },
                { t: "Double", title: "Bike + Swim", dur: "1h25", tss: 75, fl: "Moderate", rec: "E", ex: ["BIKE: 4x1m Fast Pedal", "SWIM: 40m Easy"] },
                { t: "Bike", title: "Recovery Spin", dur: "30m", tss: 15, fl: "Low", rec: "B", ex: ["30m Z1 Spin", "Rest"] },
                { t: "Swim", title: "Easy Swim", dur: "45m", tss: 30, fl: "Moderate", rec: "A", ex: ["Easy Feel", "Aerobic Maint"] },
                { t: "Double", title: "Taper + Endurance", dur: "2h50", tss: 150, fl: "Moderate", rec: "B", ex: ["Run: 50m Z2", "Bike: 2h Z2 Steady"] }
            ]},
            8: { title: "Phase 2: Taper", focus: "Shedding Fatigue", days: [
                { t: "Run", title: "Sharpness", dur: "40m", tss: 55, fl: "Moderate", rec: "B", ex: ["4x400m @ 5k Pace", "Leg Speed"] },
                { t: "Double", title: "Swim + Run (Rec)", dur: "1h", tss: 50, fl: "Moderate", rec: "D", ex: ["SWIM: 40m Easy", "RUN: 20m Easy Z2"] },
                { t: "Double", title: "Double Taper", dur: "1h15", tss: 85, fl: "High", rec: "C", ex: ["Run: 10m @ Tempo", "Bike: 45m w/ 3x30s Spin-ups"] },
                { t: "Double", title: "Bike + Swim", dur: "1h25", tss: 75, fl: "Moderate", rec: "E", ex: ["BIKE: 45m Openers", "SWIM: 40m Easy"] },
                { t: "Bike", title: "Recovery Spin", dur: "30m", tss: 15, fl: "Low", rec: "B", ex: ["30m Z1 Spin", "Rest"] },
                { t: "Double", title: "Activation", dur: "1h", tss: 50, fl: "Moderate", rec: "B", ex: ["SWIM: 20m Very Easy", "BIKE: 45m Easy Spin"] },
                { t: "Double", title: "Shakeout", dur: "1h10", tss: 70, fl: "High", rec: "A", ex: ["Run: 40m Easy", "Run: 30m Jog"] }
            ]},
            9: { title: "Race Week", focus: "Priming", days: [
                { t: "Bike", title: "Spin", dur: "30m", tss: 15, fl: "Low", rec: "A", ex: ["Easy Z1 Spin"] },
                { t: "Double", title: "Swim + Run", dur: "1h10", tss: 65, fl: "Moderate", rec: "D", ex: ["SWIM: 40m Easy", "RUN: 30m w/ 4x30s Strides"] },
                { t: "Bike", title: "Openers", dur: "45m", tss: 35, fl: "High", rec: "C", ex: ["2x3m @ Race Pace"] },
                { t: "Double", title: "Swim + Run", dur: "50m", tss: 35, fl: "Moderate", rec: "E", ex: ["SWIM: 30m Easy", "RUN: 20m Easy Jog"] },
                { t: "Bike", title: "Load Spin", dur: "20m", tss: 10, fl: "High", rec: "B", ex: ["Sodium Load", "Very Easy"] },
                { t: "Double", title: "Checks", dur: "25m", tss: 20, fl: "High", rec: "B", ex: ["Bike: 15m Gear Check", "Run: 10m Jog Check"] },
                { t: "RACE", title: "OMW 2026", dur: "4h+", tss: 250, fl: "High", rec: "A", ex: ["10k Run", "GAP (90m)", "40mi Gravel"] }
            ]}
        };

        // --- STATE ---
        let state = {
            tab: 'plan',
            week: 1,
            day: 0, // 0 index = Monday
            temp: "30-40F",
            cond: "Dry",
            checked: {}
        };

        // --- RENDER FUNCTIONS ---
        function render() {
            // Update Nav
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.id === `btn-${state.tab}`;
                btn.className = isActive 
                    ? "nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-blue-400 bg-slate-800 transition-all cursor-pointer shadow-lg shadow-blue-900/10" 
                    : "nav-btn flex flex-col lg:flex-row items-center lg:px-4 lg:py-3 rounded-xl text-slate-500 hover:bg-slate-800 transition-all cursor-pointer";
            });

            const main = document.getElementById('main-content');
            main.innerHTML = '';

            if (state.tab === 'plan') renderPlan(main);
            if (state.tab === 'fuel') renderFuel(main);
            if (state.tab === 'recovery') renderRecovery(main);
            if (state.tab === 'gear') renderGear(main);

            lucide.createIcons();
        }

        function renderPlan(container) {
            const weekData = WEEKS[state.week];
            const dayData = weekData.days[state.day];
            const isRace = dayData.t === 'RACE';

            // Week Selector
            let weekHtml = '<div class="flex overflow-x-auto gap-2 pb-4 no-scrollbar mb-2">';
            for(let i=1; i<=9; i++) {
                const active = state.week === i ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/20' : 'bg-slate-800 text-slate-400 hover:bg-slate-700';
                weekHtml += `<button onclick="setWeek(${i})" class="flex-shrink-0 px-4 py-2 rounded-lg text-xs font-bold transition-all ${active}">W${i}</button>`;
            }
            weekHtml += '</div>';

            // Day Selector
            let dayHtml = '<div class="flex justify-between bg-slate-900 p-1 rounded-xl mb-6">';
            ['M','T','W','T','F','S','S'].forEach((d, i) => {
                const active = state.day === i ? 'bg-blue-500 text-white shadow-lg' : 'text-slate-500 hover:bg-slate-800';
                dayHtml += `<button onclick="setDay(${i})" class="w-10 h-10 rounded-lg text-sm font-bold transition-all ${active}">${d}</button>`;
            });
            dayHtml += '</div>';

            // Main Card
            const borderColor = isRace ? 'border-amber-500/50' : 'border-slate-700';
            const bgColor = isRace ? 'bg-amber-950/20' : 'bg-slate-800';
            const typeColor = isRace ? 'bg-amber-500 text-black' : 
                              dayData.t === 'Double' ? 'bg-purple-500/20 text-purple-400' : 'bg-blue-500/20 text-blue-400';
            
            // Flux Badge
            const fluxInfo = FLUX_DATA[dayData.fl];
            const fluxBadge = `<div class="inline-flex items-center px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-${fluxInfo.color}-900/30 text-${fluxInfo.color}-400 border border-${fluxInfo.color}-900/50 mb-4">
                <i data-lucide="flame" class="w-3 h-3 mr-1"></i> ${dayData.fl} Flux
            </div>`;

            // Exercises
            let exHtml = '';
            dayData.ex.forEach((ex, idx) => {
                const uid = `w${state.week}d${state.day}e${idx}`;
                const isChecked = state.checked[uid];
                exHtml += `
                <div onclick="toggleCheck('${uid}')" class="bg-slate-900/40 p-3 rounded-lg border border-slate-700/50 flex items-center gap-3 cursor-pointer hover:border-slate-600 transition-colors mb-2">
                    <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${isChecked ? 'bg-blue-500 border-blue-500' : 'border-slate-600'}">
                        ${isChecked ? '<i data-lucide="check" class="w-3 h-3 text-white"></i>' : ''}
                    </div>
                    <span class="${isChecked ? 'text-slate-500 line-through' : 'text-slate-200'} font-medium text-sm">${ex}</span>
                </div>`;
            });

            // Recovery Link
            const recData = RECOVERY_ROUTINES[dayData.rec];
            const recHtml = recData ? `
            <button onclick="goToRecovery('${dayData.rec}')" class="w-full mt-4 p-4 rounded-xl bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition-all flex items-center justify-between group">
                <div class="flex items-center gap-3">
                    <div class="bg-slate-800 p-2 rounded-lg text-indigo-400"><i data-lucide="activity" class="w-4 h-4"></i></div>
                    <div class="text-left">
                        <div class="text-[10px] text-slate-500 uppercase font-bold">Post-Workout</div>
                        <div class="text-sm font-bold text-white group-hover:text-blue-400 transition-colors">${recData.title}</div>
                    </div>
                </div>
                <i data-lucide="chevron-right" class="text-slate-600 group-hover:text-slate-400"></i>
            </button>` : '';

            container.innerHTML = `
                <div class="fade-in">
                    <div class="mb-4">
                        <div class="text-xs text-blue-400 font-bold uppercase tracking-wider">${weekData.title}</div>
                        <h2 class="text-2xl font-bold text-white">${weekData.focus}</h2>
                    </div>
                    ${weekHtml}
                    ${dayHtml}
                    <div class="${bgColor} border ${borderColor} rounded-2xl p-6 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-4">
                            <span class="${typeColor} px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider">${dayData.t}</span>
                            <div class="text-xs text-slate-400 font-mono flex items-center gap-2">
                                <span><i data-lucide="clock" class="inline w-3 h-3"></i> ${dayData.dur}</span>
                                <span>|</span>
                                <span>${dayData.tss} TSS</span>
                            </div>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">${dayData.title}</h3>
                        ${fluxBadge}
                        <div class="space-y-2">
                            ${exHtml}
                        </div>
                        ${recHtml}
                    </div>
                </div>
            `;
        }

        function renderRecovery(container) {
            let html = `
            <div class="fade-in">
                <div class="bg-gradient-to-r from-indigo-900/50 to-slate-900 p-6 rounded-2xl border border-indigo-500/30 mb-6">
                    <h2 class="text-2xl font-bold text-white mb-1">Recovery Vault</h2>
                    <p class="text-indigo-200/70 text-sm">Mechanical routines to reset the nervous system.</p>
                </div>
                <div class="grid gap-4">`;
            
            for (const [key, r] of Object.entries(RECOVERY_ROUTINES)) {
                let stepsHtml = r.steps.map((s, i) => `
                    <div class="flex gap-3 relative z-10">
                        <div class="flex-shrink-0 w-5 h-5 rounded-full bg-slate-800 border border-slate-700 text-[10px] flex items-center justify-center text-slate-400 font-mono mt-0.5">${i+1}</div>
                        <span class="text-sm text-slate-300 leading-snug">${s}</span>
                    </div>
                `).join('');

                const isTarget = window.targetRec === key;
                const borderClass = isTarget ? 'border-indigo-500 bg-indigo-900/20 ring-1 ring-indigo-500' : 'border-slate-700 bg-slate-800';

                html += `
                <div id="rec-${key}" class="p-5 rounded-xl border ${borderClass} transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white">${r.title}</h3>
                            <p class="text-indigo-400 text-xs font-bold uppercase tracking-wider">${r.sub}</p>
                        </div>
                        <span class="text-[10px] bg-slate-900 px-2 py-1 rounded text-slate-400 border border-slate-700 font-mono">${r.time}</span>
                    </div>
                    <div class="space-y-3 relative">
                        <div class="absolute left-2.5 top-2 bottom-2 w-px bg-slate-700/50"></div>
                        ${stepsHtml}
                    </div>
                </div>`;
            }
            html += '</div></div>';
            container.innerHTML = html;
            
            if(window.targetRec) {
                setTimeout(() => {
                    document.getElementById(`rec-${window.targetRec}`).scrollIntoView({behavior: 'smooth', block: 'center'});
                    window.targetRec = null;
                }, 100);
            }
        }

        function renderFuel(container) {
            const currentFlux = WEEKS[state.week].days[state.day].fl;
            const data = FLUX_DATA[currentFlux];
            const color = data.color; // 'green', 'yellow', 'red' (Note: tailwind classes need full names usually, doing manual map below)
            
            const colorMap = {
                'green': { bg: 'bg-emerald-900/20', border: 'border-emerald-500/50', text: 'text-emerald-500', icon: 'text-emerald-400' },
                'yellow': { bg: 'bg-yellow-900/20', border: 'border-yellow-500/50', text: 'text-yellow-500', icon: 'text-yellow-400' },
                'red': { bg: 'bg-red-900/20', border: 'border-red-500/50', text: 'text-red-500', icon: 'text-red-400' }
            };
            const c = colorMap[color];

            container.innerHTML = `
            <div class="fade-in space-y-6">
                <div class="p-6 rounded-2xl border ${c.bg} ${c.border}">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="flame" class="${c.icon} w-6 h-6"></i>
                        <h2 class="text-2xl font-bold text-white">${currentFlux} Flux</h2>
                    </div>
                    <p class="text-slate-300 text-sm leading-relaxed">${data.desc}</p>
                </div>

                <div class="bg-slate-800 rounded-xl overflow-hidden border border-slate-700">
                    <div class="bg-slate-900 p-4 border-b border-slate-700 font-bold text-white text-xs uppercase tracking-wider">Daily Protocol</div>
                    <div class="divide-y divide-slate-700">
                        ${fuelRow('coffee', 'Breakfast', data.b)}
                        ${fuelRow('utensils', 'Lunch', data.l)}
                        ${fuelRow('zap', 'Pre-Workout', data.pre)}
                        ${fuelRow('droplets', 'Intra-Workout', data.intra)}
                        ${fuelRow('utensils', 'Dinner', data.d)}
                    </div>
                </div>
            </div>`;
        }

        function fuelRow(icon, label, val) {
            return `<div class="p-4 flex gap-4 items-center">
                <i data-lucide="${icon}" class="text-slate-500 w-5 h-5 flex-shrink-0"></i>
                <div>
                    <div class="text-[10px] text-slate-500 font-bold uppercase">${label}</div>
                    <div class="text-slate-200 text-sm font-medium">${val}</div>
                </div>
            </div>`;
        }

        function renderGear(container) {
            const data = GEAR_MATRIX[state.temp][state.cond];
            container.innerHTML = `
            <div class="fade-in space-y-6">
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <h2 class="text-2xl font-bold text-white mb-6">Gear Calculator</h2>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="text-xs text-slate-500 uppercase font-bold mb-2 block">Temp</label>
                            <select onchange="setTemp(this.value)" class="w-full bg-slate-900 border border-slate-700 text-white rounded-lg p-3 text-sm outline-none">
                                ${Object.keys(GEAR_MATRIX).map(t => `<option value="${t}" ${t===state.temp?'selected':''}>${t}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-500 uppercase font-bold mb-2 block">Condition</label>
                            <select onchange="setCond(this.value)" class="w-full bg-slate-900 border border-slate-700 text-white rounded-lg p-3 text-sm outline-none">
                                <option value="Dry" ${state.cond==='Dry'?'selected':''}>Dry</option>
                                <option value="Wet" ${state.cond==='Wet'?'selected':''}>Wet / Snow</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="bg-slate-900 rounded-xl p-5 border border-slate-700 space-y-5">
                        ${gearRow('wind', 'Upper Body', data.u, 'blue')}
                        ${gearRow('activity', 'Lower Body', data.l, 'blue')}
                        ${gearRow('thermometer', 'Extremities', data.e, 'orange')}
                    </div>
                </div>
            </div>`;
        }

        function gearRow(icon, label, val, color) {
            return `<div class="flex gap-4 items-start">
                <div class="bg-${color}-500/20 p-2 rounded text-${color}-400 mt-1"><i data-lucide="${icon}" class="w-4 h-4"></i></div>
                <div>
                    <div class="text-[10px] text-slate-500 uppercase font-bold">${label}</div>
                    <div class="text-white font-medium text-sm">${val}</div>
                </div>
            </div>`;
        }

        // --- ACTIONS ---
        function switchTab(t) { state.tab = t; render(); }
        function setWeek(w) { state.week = w; render(); }
        function setDay(d) { state.day = d; render(); }
        function setTemp(t) { state.temp = t; render(); }
        function setCond(c) { state.cond = c; render(); }
        function toggleCheck(id) { state.checked[id] = !state.checked[id]; render(); }
        function goToRecovery(id) { window.targetRec = id; switchTab('recovery'); }

        // Init
        render();

    </script>
</body>
</html>
